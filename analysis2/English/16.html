<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis 2: Final Exam - Corrected Version</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <style>
        /* Custom styles for a polished and modern look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Dark blue-slate background */
            color: #e2e8f0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%231e293b' fill-opacity='0.4'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h4v-9H0v-1h4v-9H0v-1h4v-9H0v-1h4v-9H0v-1h4v-9H0v-1h4v-9H0v-1h4v-9H0v-1h4v-9H0v-1h4V0h1v4h9V0h1v4h9V0h1v4h9V0h1v4h9V0h1v4h9V0h1v4h9V0h1v4h9V0h1v4h9V0h1v4h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5h-9v5h-1v-5H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5v-9H0v-1h5V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5h9V0h1v5Z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }
        
        .exam-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.5); /* Semi-transparent slate */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        .exam-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(100, 116, 139, 0.5);
        }
        
        .exam-title {
            font-size: 2.75rem;
            color: #f1f5f9;
            font-weight: 800;
        }
        
        .exam-subtitle {
            font-size: 1.25rem;
            color: #94a3b8;
        }
        
        .section-title {
            font-size: 2.25rem;
            color: #e2e8f0;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #4f46e5;
        }
        
        .exercise {
            margin-bottom: 2.5rem;
            padding: 2rem;
            border-radius: 1rem;
            background-color: rgba(15, 23, 42, 0.5);
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }
        .exercise:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border-color: #4f46e5;
        }
        
        .exercise-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #93c5fd; /* Light blue for titles */
            margin-bottom: 1rem;
        }

        .exercise-content p, .modal-content p {
            line-height: 1.8;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }
        
        .btn-container {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            border-radius: 9999px; /* Pill shape */
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-secondary {
            background-color: #475569;
            color: white;
        }
        .btn-tertiary {
            background-color: #10b981;
            color: white;
        }
        
        .modal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #1e293b;
            margin: auto;
            padding: 2.5rem;
            border: 1px solid #475569;
            width: 90%;
            max-width: 700px;
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            animation: fadeIn 0.5s;
            color: #e2e8f0;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #475569;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.75rem;
            color: #f1f5f9;
        }
        
        .close-btn {
            color: #94a3b8;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: #f1f5f9;
        }
        
        @keyframes fadeIn {
            from {opacity: 0; transform: scale(0.95) translateY(10px);}
            to {opacity: 1; transform: scale(1) translateY(0);}
        }

        .katex-display {
            background-color: rgba(15, 23, 42, 0.7);
            border: 1px solid #334155;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
        }

        .cs-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid #334155;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.4), 0 2px 4px -1px rgba(0,0,0,0.2);
        }
        .cs-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3), 0 10px 10px -5px rgba(0,0,0,0.2);
            border-color: #4f46e5;
        }
        
        pre[class*="language-"] {
            background: #0f172a;
            color: #e2e8f0;
            padding: 1.5em;
            margin: 1em 0;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Fira Code', 'Courier New', Courier, monospace;
            border: 1px solid #334155;
        }
    </style>
</head>
<body class="antialiased">

    <div class="exam-container">
        <header class="exam-header">
            <h1 class="exam-title">Analysis 2</h1>
            <p class="exam-subtitle">Final Exam (Monday, May 26, 2008)</p>
        </header>

        <main>
            <section id="exam-questions">
                <h2 class="section-title">Exam Questions</h2>
                
                <div class="exercise">
                    <h3 class="exercise-title">Exercise 1 (5 points)</h3>
                    <div class="exercise-content">
                        <p>Calculate:</p>
                        <p>1. <span class="katex-inline" data-id="ex1-q1"></span></p>
                        <p>2. <span class="katex-inline" data-id="ex1-q2"></span></p>
                        <p>3. <span class="katex-inline" data-id="ex1-q3"></span></p>
                    </div>
                    <div class="btn-container">
                        <button class="btn btn-primary" onclick="showModal('hint1')">Hint</button>
                        <button class="btn btn-secondary" onclick="showModal('knowledge1')">Prerequisites</button>
                    </div>
                </div>

                <div class="exercise">
                    <h3 class="exercise-title">Exercise 2 (5 points)</h3>
                    <div class="exercise-content">
                        <p>Let <span class="katex-inline" data-id="ex2-I"></span> and <span class="katex-inline" data-id="ex2-J"></span>.</p>
                        <p>1. Compare the integrals I and J. (Hint: let <span class="katex-inline" data-id="ex2-q1-sub"></span>).</p>
                        <p>2. Calculate the sum <span class="katex-inline" data-id="ex2-q2-sum"></span>.</p>
                        <p>3. Deduce the values of I and J.</p>
                    </div>
                    <div class="btn-container">
                        <button class="btn btn-primary" onclick="showModal('hint2')">Hint</button>
                        <button class="btn btn-secondary" onclick="showModal('knowledge2')">Prerequisites</button>
                    </div>
                </div>

                <div class="exercise">
                    <h3 class="exercise-title">Exercise 3 (10 points)</h3>
                    <div class="exercise-content">
                         <p>1. Let f be the function defined on <span class="katex-inline" data-id="ex3-q1-dom"></span> by <span class="katex-inline" data-id="ex3-q1-f"></span>.</p>
                        <p>(a) Calculate the derivative <span class="katex-inline" data-id="ex3-q1a-deriv"></span> of <span class="katex-inline" data-id="ex3-q1a-f"></span> for all <span class="katex-inline" data-id="ex3-q1a-x"></span>.</p>
                        <p>(b) Give the first-order Taylor expansion of <span class="katex-inline" data-id="ex3-q1b-deriv"></span> in the neighborhood of <span class="katex-inline" data-id="ex3-q1b-x0"></span>.</p>
                        <p>(c) From this, deduce the second-order Taylor expansion of <span class="katex-inline" data-id="ex3-q1c-f"></span> in the neighborhood of <span class="katex-inline" data-id="ex3-q1c-x0"></span>.</p>
                        <p>2. Let g be the function defined on <span class="katex-inline" data-id="ex3-q2-dom"></span> by <span class="katex-inline" data-id="ex3-q2-g"></span>.</p>
                        <p>(a) Using the result from 1(c), give the second-order Taylor expansion of g in the neighborhood of <span class="katex-inline" data-id="ex3-q2a-x0"></span>.</p>
                        <p>(b) Deduce the equation of the tangent to the curve <span class="katex-inline" data-id="ex3-q2b-cg"></span> of g at the point <span class="katex-inline" data-id="ex3-q2b-x0"></span>.</p>
                        <p>(c) Specify the position of this tangent relative to the curve <span class="katex-inline" data-id="ex3-q2c-cg"></span> in the neighborhood of the point <span class="katex-inline" data-id="ex3-q2c-x0"></span>.</p>
                        <p>3. Let F be the function from <span class="katex-inline" data-id="ex3-q3-R"></span> to <span class="katex-inline" data-id="ex3-q3-R2"></span> defined by <span class="katex-inline" data-id="ex3-q3-F"></span>.</p>
                        <p>(a) Show that for <span class="katex-inline" data-id="ex3-q3a-x"></span>, <span class="katex-inline" data-id="ex3-q3a-F0"></span>.</p>
                        <p>(b) Give the third-order Taylor expansion in the neighborhood of <span class="katex-inline" data-id="ex3-q3b-inf"></span> for the function <span class="katex-inline" data-id="ex3-q3b-phi"></span>.</p>
                        <p>(c) From this, deduce the equation of the oblique asymptote in the neighborhood of <span class="katex-inline" data-id="ex3-q3c-inf"></span> to the curve <span class="katex-inline" data-id="ex3-q3c-cpsi"></span> of the function <span class="katex-inline" data-id="ex3-q3c-psi"></span>.</p>
                        <p>(d) Determine the position of this asymptote relative to <span class="katex-inline" data-id="ex3-q3d-cpsi"></span> in the neighborhood of <span class="katex-inline" data-id="ex3-q3d-inf"></span>.</p>
                    </div>
                    <div class="btn-container">
                        <button class="btn btn-primary" onclick="showModal('hint3')">Hint</button>
                        <button class="btn btn-secondary" onclick="showModal('knowledge3')">Prerequisites</button>
                    </div>
                </div>
            </section>

            <section id="exam-solutions">
                <h2 class="section-title">Detailed Solutions</h2>

                <div class="exercise">
                    <h3 class="exercise-title">Solution for Exercise 1</h3>
                    <div class="exercise-content">
                        <p>1. For <span class="katex-inline" data-id="sol1-p1-int"></span>, we use the substitution <span class="katex-inline" data-id="sol1-p1-sub"></span>. We have <span class="katex-inline" data-id="sol1-p1-dx"></span>. The integral becomes <span class="katex-inline" data-id="sol1-p1-new-int"></span>. We decompose it into partial fractions: <span class="katex-inline" data-id="sol1-p1-decomp"></span>. We find <span class="katex-inline" data-id="sol1-p1-consts"></span>. The integration gives:</p>
                        <div class="katex-display" data-id="sol1-p1-res"></div>
                        <p>2. For <span class="katex-inline" data-id="sol1-p2-int"></span>, we let <span class="katex-inline" data-id="sol1-p2-sub"></span>, which gives <span class="katex-inline" data-id="sol1-p2-rel"></span> and <span class="katex-inline" data-id="sol1-p2-du"></span>. The bounds become 0 and 1. The integral becomes:</p>
                        <div class="katex-display" data-id="sol1-p2-new-int"></div>
                        <p>3. For <span class="katex-inline" data-id="sol1-p3-int"></span>, we integrate by parts with <span class="katex-inline" data-id="sol1-p3-u"></span> and <span class="katex-inline" data-id="sol1-p3-dv"></span>. We obtain:</p>
                        <div class="katex-display" data-id="sol1-p3-ipp"></div>
                        <p>The remaining integral is calculated by polynomial division and partial fraction decomposition, leading to the final result:</p>
                        <div class="katex-display" data-id="sol1-p3-final"></div>
                    </div>
                    <div class="btn-container">
                        <button class="btn btn-tertiary" onclick="showModal('explanation1')">Detailed Explanation</button>
                    </div>
                </div>

                <div class="exercise">
                    <h3 class="exercise-title">Solution for Exercise 2</h3>
                    <div class="exercise-content">
                        <p>1. With the substitution <span class="katex-inline" data-id="sol2-p1-sub"></span>, we have <span class="katex-inline" data-id="sol2-p1-dt"></span>. Substituting into I:</p>
                        <div class="katex-display" data-id="sol2-p1-eval"></div>
                        <p>We use <span class="katex-inline" data-id="sol2-p1-sin"></span> and <span class="katex-inline" data-id="sol2-p1-cos"></span>. The integral becomes <span class="katex-inline" data-id="sol2-p1-J"></span>. Thus <span class="katex-inline" data-id="sol2-p1-eq"></span>.</p>
                        <p>2. We calculate the sum <span class="katex-inline" data-id="sol2-p2-sum"></span>:</p>
                        <div class="katex-display" data-id="sol2-p2-sum-int"></div>
                        <p>The denominator is <span class="katex-inline" data-id="sol2-p2-denom"></span>, which is positive on <span class="katex-inline" data-id="sol2-p2-interval"></span>. So:</p>
                        <div class="katex-display" data-id="sol2-p2-res"></div>
                        <p>3. Since <span class="katex-inline" data-id="sol2-p3-eq"></span> and <span class="katex-inline" data-id="sol2-p3-sum"></span>, we deduce that <span class="katex-inline" data-id="sol2-p3-final"></span>.</p>
                    </div>
                    <div class="btn-container">
                        <button class="btn btn-tertiary" onclick="showModal('explanation2')">Detailed Explanation</button>
                    </div>
                </div>

                <div class="exercise">
                    <h3 class="exercise-title">Solution for Exercise 3</h3>
                    <div class="exercise-content">
                        <p>1. (a) The derivative of <span class="katex-inline" data-id="sol3-p1a-f"></span> is <span class="katex-display" data-id="sol3-p1a-deriv"></span></p>
                        <p>(b) The 1st-order Taylor expansion of <span class="katex-inline" data-id="sol3-p1b-deriv"></span> at 0 is <span class="katex-display" data-id="sol3-p1b-dl"></span></p>
                        <p>(c) By integrating the Taylor expansion of the derivative, the 2nd-order Taylor expansion of <span class="katex-inline" data-id="sol3-p1c-f"></span> at 0 is <span class="katex-display" data-id="sol3-p1c-dl"></span></p>
                        <p>2. (a) For <span class="katex-inline" data-id="sol3-p2a-g"></span>, we let <span class="katex-inline" data-id="sol3-p2a-u"></span>. The Taylor expansion at 2 is <span class="katex-display" data-id="sol3-p2a-dl"></span></p>
                        <p>(b) The equation of the tangent at <span class="katex-inline" data-id="sol3-p2b-x0"></span> is <span class="katex-display" data-id="sol3-p2b-tan"></span></p>
                        <p>(c) The position is given by <span class="katex-inline" data-id="sol3-p2c-pos"></span>. The curve is below the tangent.</p>
                        <p>3. (a) For <span class="katex-inline" data-id="sol3-p3a-x"></span>, we show that <span class="katex-inline" data-id="sol3-p3a-deriv"></span>. Since <span class="katex-inline" data-id="sol3-p3a-Fsqrt2"></span>, we have <span class="katex-inline" data-id="sol3-p3a-F0"></span>.</p>
                        <p>(b) The Taylor expansion of <span class="katex-inline" data-id="sol3-p3b-arccos"></span> near <span class="katex-inline" data-id="sol3-p3b-inf"></span> is <span class="katex-display" data-id="sol3-p3b-dl"></span></p>
                        <p>(c) We have <span class="katex-inline" data-id="sol3-p3c-psi-eq"></span>. The asymptotic expansion is <span class="katex-display" data-id="sol3-p3c-asymp"></span> The asymptote is <span class="katex-inline" data-id="sol3-p3c-asymp-eq"></span>.</p>
                        <p>(d) The difference <span class="katex-inline" data-id="sol3-p3d-diff"></span> is negative, the curve is below the asymptote.</p>
                    </div>
                    <div class="btn-container">
                        <button class="btn btn-tertiary" onclick="showModal('explanation3')">Detailed Explanation</button>
                    </div>
                </div>
            </section>

            <section id="cs-applications">
                <h2 class="section-title">Applications in Computer Science</h2>
                <div class="space-y-12">
    
                    <div class="cs-card">
                        <h3 class="text-3xl font-bold text-purple-400 mb-4">1. Integration Techniques: Symbolic Computation Engines 💻</h3>
                        <p class="text-lg mb-4 text-slate-300">The various techniques for calculating integrals (substitution, integration by parts, partial fraction decomposition) are at the heart of <strong>computer algebra systems</strong> like WolframAlpha or Maple. These programs don't just compute numerically; they attempt to find an exact antiderivative by applying a decision tree of strategies, just like a student would.</p>
                        <h4 class="text-xl font-semibold text-slate-200 mt-6 mb-2">Practical Example: The Risch Algorithm</h4>
                        <p class="mb-4 text-slate-400">The Risch algorithm is a complex procedure that can determine whether an elementary function has an elementary antiderivative and, if so, find it. It classifies the integrand and applies specific rules. For instance, for a rational function, it will systematically apply partial fraction decomposition. For a product of functions, it will attempt integration by parts. It's the automation of the methods seen in Exercise 1.</p>
                        <pre class="language-pseudocode"><code>function symbolicIntegrate(expression) {
    if (isRationalFunction(expression)) {
        // Apply partial fraction decomposition
        let parts = partialFractionDecomposition(expression);
        return sum(integrate(p) for p in parts);
    } 
    else if (isProduct(expression, "log", f(x))) {
        // Attempt integration by parts
        return integrationByParts(expression, u="log", dv=f(x));
    }
    else if (canApplySubstitution(expression, sub="tan(x)")) {
        // Apply change of variable
        return applyChangeOfVariable(expression, sub="tan(x)");
    }
    // ... and dozens of other rules
    else {
        return "No elementary antiderivative found.";
    }
}</code></pre>
                    </div>
    
                    <div class="cs-card">
                        <h3 class="text-3xl font-bold text-purple-400 mb-4">2. Symmetry of Integrals: Signal Processing and Graphics 🎶</h3>
                        <p class="text-lg mb-4 text-slate-300">The trick in Exercise 2, where we show <span class="katex-inline" data-id="cs2-IeqJ"></span> by using interval symmetry, is a very powerful idea in computer science. It's fundamental in <strong>signal processing</strong> with Fourier series, which decompose a signal into a sum of sines and cosines. The orthogonality of these functions (the fact that their products integrate to zero over an interval) relies on similar symmetry arguments.</p>
                        <h4 class="text-xl font-semibold text-slate-200 mt-6 mb-2">Practical Example: JPEG Image Compression</h4>
                        <p class="mb-4 text-slate-400">JPEG compression uses a variant of the Fourier transform, the <strong>Discrete Cosine Transform (DCT)</strong>. It transforms blocks of image pixels into a sum of "frequencies" (cosine patterns). Since most visual energy is in the low frequencies, we can ignore (set to zero) the high frequencies with little loss of quality, which compresses the data. The efficient calculation of the DCT and its inverse relies on the symmetry properties of cosine functions.</p>
                         <pre class="language-pseudocode"><code>// The basic idea of the Fourier transform
    // A signal f(t) can be represented by its coefficients a_n and b_n
    
    // a_n = ∫ f(t) * cos(n*t) dt  // Projection onto cosines
    // b_n = ∫ f(t) * sin(n*t) dt  // Projection onto sines
    
    // The fact that ∫ sin(n*t)*cos(m*t) dt = 0 (for n≠m) is due to symmetry.
    // This allows for the unique recovery of coefficients.
    
    function getFourierCoefficients(signal) {
      let a = [];
      let b = [];
      for (let n = 0; n < MAX_FREQUENCIES; n++) {
        a[n] = integrate(t => signal(t) * cos(n*t));
        b[n] = integrate(t => signal(t) * sin(n*t));
      }
      return { a, b };
    }
    </code></pre>
                    </div>
                    
                    <div class="cs-card">
                        <h3 class="text-3xl font-bold text-purple-400 mb-4">3. Taylor Series: Approximation in Computer Science ⚡️</h3>
                        <p class="text-lg mb-4 text-slate-300">Taylor series are one of the most important tools in applied computer science. Computers cannot store functions like <span class="katex-inline" data-id="cs3-sin"></span> or <span class="katex-inline" data-id="cs3-exp"></span>. Instead, they use <strong>polynomial approximations</strong>, which are simply truncated Taylor series. Exercise 3, which involves finding Taylor expansions, tangents (1st-order expansions), and asymptotes, is exactly what a computer does to handle complex functions.</p>
                        <h4 class="text-xl font-semibold text-slate-200 mt-6 mb-2">Practical Example: The `sin(x)` function in a calculator</h4>
                        <p class="mb-4 text-slate-400">When you type `sin(0.1)` into a calculator, it doesn't consult an infinite table. It calculates the first few terms of the Taylor series for sine: <span class="katex-inline" data-id="cs3-sin-dl"></span>. For small values of x, a few terms are enough for extreme precision. The position of the curve relative to the tangent (given by the sign of the next term) indicates whether the approximation will be an overestimate or an underestimate.</p>
                        <pre class="language-pseudocode"><code>// Calculation of sin(x) with its Taylor series at 0
    function fast_sin(x) {
      // For better precision, bring x into [-π, π]
      x = reduce_angle(x);
      
      let x_squared = x * x;
      
      // 5th order expansion: x - x^3/6 + x^5/120
      let term1 = x;
      let term2 = -(x_squared * x) / 6.0;         // 3! = 6
      let term3 = (x_squared * x_squared * x) / 120.0; // 5! = 120
      
      return term1 + term2 + term3;
    }
    
    // The Taylor series also gives us the tangent at 0 (y=x)
    // and the position (sin(x) < x for x>0), because the x^3 term is negative.
    </code></pre>
                    </div>
    
                </div>
            </section>
        </main>
    </div>

    <div id="hint1" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Hint for Exercise 1</h3><span class="close-btn" onclick="closeModal('hint1')">&times;</span></div><p>1. For the first integral, try dividing the numerator and denominator by <span class="katex-inline" data-id="h1-k1"></span> to make a tangent appear, then perform a substitution.</p><p>2. For the second one, a simple substitution involving the square root will greatly simplify the expression.</p><p>3. The third integral requires integration by parts. Choose wisely which function to differentiate and which to integrate.</p></div></div>
    <div id="knowledge1" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Prerequisites for Exercise 1</h3><span class="close-btn" onclick="closeModal('knowledge1')">&times;</span></div><p><strong>Change of Variables (Substitution):</strong> A fundamental technique to simplify integrals. If <span class="katex-inline" data-id="k1-f1"></span>, then <span class="katex-inline" data-id="k1-f2"></span>.</p><p><strong>Integration by Parts:</strong> Formula <span class="katex-inline" data-id="k1-f3"></span>. Useful when the integrand is a product of functions.</p><p><strong>Partial Fraction Decomposition:</strong> Method to integrate rational functions by splitting them into simpler fractions.</p><p><strong>Polynomial Long Division:</strong> Used to simplify a rational function when the degree of the numerator is greater than or equal to that of the denominator.</p></div></div>
    <div id="explanation1" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Detailed Explanation for Exercise 1</h3><span class="close-btn" onclick="closeModal('explanation1')">&times;</span></div><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">1. Calculation of <span class="katex-inline" data-id="e1-p1-int"></span></h4><p>We divide the numerator and denominator by <span class="katex-inline" data-id="e1-p1-cos"></span> to get <span class="katex-inline" data-id="e1-p1-tan-form"></span>. We let <span class="katex-inline" data-id="e1-p1-sub"></span>, which gives <span class="katex-inline" data-id="e1-p1-dx"></span>. The integral transforms into <span class="katex-inline" data-id="e1-p1-t-int"></span>.</p><p>We decompose the rational fraction <span class="katex-inline" data-id="e1-p1-frac"></span> into partial fractions: <span class="katex-inline" data-id="e1-p1-decomp"></span>. By identifying coefficients, we find <span class="katex-inline" data-id="e1-p1-coeffs"></span>.</p><p>The integral becomes <span class="katex-inline" data-id="e1-p1-int-decomp"></span>. By integrating each term, we get <span class="katex-inline" data-id="e1-p1-res-t"></span>. Reverting to the variable x, we have the final result.</p><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">2. Calculation of <span class="katex-inline" data-id="e1-p2-int"></span></h4><p>We perform the substitution <span class="katex-inline" data-id="e1-p2-sub"></span>. This implies <span class="katex-inline" data-id="e1-p2-u2"></span> and therefore <span class="katex-inline" data-id="e1-p2-du"></span>. We must also change the bounds: if <span class="katex-inline" data-id="e1-p2-x0"></span>, <span class="katex-inline" data-id="e1-p2-u0"></span>; if <span class="katex-inline" data-id="e1-p2-xlog2"></span>, <span class="katex-inline" data-id="e1-p2-u1"></span>.</p><p>The integral is rewritten as <span class="katex-inline" data-id="e1-p2-new-int"></span>. This is a simple integral: <span class="katex-inline" data-id="e1-p2-calc"></span>.</p><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">3. Calculation of <span class="katex-inline" data-id="e1-p3-int"></span></h4><p>We use integration by parts (IBP): <span class="katex-inline" data-id="e1-p3-ipp-formula"></span>. We set <span class="katex-inline" data-id="e1-p3-u"></span> and <span class="katex-inline" data-id="e1-p3-dv"></span>. We calculate <span class="katex-inline" data-id="e1-p3-du"></span> and <span class="katex-inline" data-id="e1-p3-v"></span>.</p><p>IBP gives <span class="katex-inline" data-id="e1-p3-ipp-res"></span>. The remaining integral is <span class="katex-inline" data-id="e1-p3-rem-int"></span>. The degree of the numerator is greater than that of the denominator, so we perform polynomial long division of <span class="katex-inline" data-id="e1-p3-num"></span> by <span class="katex-inline" data-id="e1-p3-den"></span>. We find a quotient and a remainder, which allows us to rewrite the fraction. We finish with a partial fraction decomposition of the remainder to complete the calculation.</p></div></div>
    <div id="hint2" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Hint for Exercise 2</h3><span class="close-btn" onclick="closeModal('hint2')">&times;</span></div><p>1. Apply the change of variable <span class="katex-inline" data-id="h2-k1"></span> to the integral I. Don't forget to change the bounds and the differential <span class="katex-inline" data-id="h2-k2"></span>. Use the formulas for <span class="katex-inline" data-id="h2-k3"></span> and <span class="katex-inline" data-id="h2-k4"></span>.</p><p>2. For the sum <span class="katex-inline" data-id="h2-k5"></span>, notice that the denominator is the same. Adding the numerators gives an expression that can be related to a notable identity.</p></div></div>
    <div id="knowledge2" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Prerequisites for Exercise 2</h3><span class="close-btn" onclick="closeModal('knowledge2')">&times;</span></div><p><strong>Trigonometry Formulas:</strong> Knowledge of <span class="katex-inline" data-id="k2-f1"></span> and <span class="katex-inline" data-id="k2-f2"></span>.</p><p><strong>Notable Identity:</strong> <span class="katex-inline" data-id="k2-f3"></span>.</p><p><strong>Properties of the Integral:</strong> Linearity (<span class="katex-inline" data-id="k2-f4"></span>) and managing bounds during a change of variable.</p></div></div>
    <div id="explanation2" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Detailed Explanation for Exercise 2</h3><span class="close-btn" onclick="closeModal('explanation2')">&times;</span></div><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">1. Comparison of I and J</h4><p>We start from <span class="katex-inline" data-id="e2-p1-I"></span>. We apply the change of variable <span class="katex-inline" data-id="e2-p1-sub"></span>, which implies <span class="katex-inline" data-id="e2-p1-x"></span> and <span class="katex-inline" data-id="e2-p1-dt"></span>.</p><p>The bounds change: if <span class="katex-inline" data-id="e2-p1-x0"></span>, <span class="katex-inline" data-id="e2-p1-tpi2"></span>. If <span class="katex-inline" data-id="e2-p1-xpi2"></span>, <span class="katex-inline" data-id="e2-p1-t0"></span>.</p><p>Integral I becomes: <span class="katex-display" data-id="e2-p1-int-sub"></span></p><p>We use the formulas <span class="katex-inline" data-id="e2-p1-sin"></span> and <span class="katex-inline" data-id="e2-p1-cos"></span>. The integral transforms into: <span class="katex-display" data-id="e2-p1-int-trans"></span></p><p>This is exactly the definition of J. Therefore, <span class="katex-inline" data-id="e2-p1-eq"></span>.</p><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">2. Calculation of I + J</h4><p>We add the two integrals: <span class="katex-display" data-id="e2-p2-sum-int"></span></p><p>We recognize the expression <span class="katex-inline" data-id="e2-p2-denom-id"></span> in the denominator. Therefore, <span class="katex-inline" data-id="e2-p2-sqrt"></span>.</p><p>On the interval <span class="katex-inline" data-id="e2-p2-interval"></span>, <span class="katex-inline" data-id="e2-p2-pos"></span>, so the absolute value is unnecessary.</p><p>The integral simplifies greatly: <span class="katex-display" data-id="e2-p2-simp-int"></span></p><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">3. Deduction of I and J</h4><p>We have a system of two equations with two unknowns:</p><p>1) <span class="katex-inline" data-id="e2-p3-eq1"></span></p><p>2) <span class="katex-inline" data-id="e2-p3-eq2"></span></p><p>By substituting (1) into (2), we get <span class="katex-inline" data-id="e2-p3-subst"></span>, which gives <span class="katex-inline" data-id="e2-p3-I"></span>. Since <span class="katex-inline" data-id="e2-p3-IeqJ"></span>, we also have <span class="katex-inline" data-id="e2-p3-J"></span>.</p></div></div>
    <div id="hint3" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Hint for Exercise 3</h3><span class="close-btn" onclick="closeModal('hint3')">&times;</span></div><p>1. For the Taylor expansions, use the standard expansions of <span class="katex-inline" data-id="h3-k1"></span> and <span class="katex-inline" data-id="h3-k2"></span>. Remember that the expansion of a function can be obtained by integrating the expansion of its derivative.</p><p>2. To find the equation of the tangent, use the formula <span class="katex-inline" data-id="h3-k3"></span>. The relative position is given by the sign of the next term in the expansion.</p><p>3. To show that <span class="katex-inline" data-id="h3-k4"></span>, show that its derivative is zero and calculate its value at a simple point (like <span class="katex-inline" data-id="h3-k5"></span>). For the asymptote, use the expansion of <span class="katex-inline" data-id="h3-k6"></span> at <span class="katex-inline" data-id="h3-k7"></span>.</p></div></div>
    <div id="knowledge3" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Prerequisites for Exercise 3</h3><span class="close-btn" onclick="closeModal('knowledge3')">&times;</span></div><p><strong>Derivatives of common functions:</strong> <span class="katex-inline" data-id="k3-f1"></span>, <span class="katex-inline" data-id="k3-f2"></span>.</p><p><strong>Taylor Expansions:</strong> Knowledge of standard expansions at 0, especially <span class="katex-inline" data-id="k3-f3"></span>, <span class="katex-inline" data-id="k3-f4"></span>, and <span class="katex-inline" data-id="k3-f5"></span>.</p><p><strong>Taylor-Young Formula:</strong> <span class="katex-inline" data-id="k3-f6"></span>.</p><p><strong>Tangent and relative position:</strong> The equation of the tangent is <span class="katex-inline" data-id="k3-f7"></span>. The sign of <span class="katex-inline" data-id="k3-f8"></span> gives the position.</p><p><strong>Oblique Asymptote:</strong> If <span class="katex-inline" data-id="k3-f9"></span>, then <span class="katex-inline" data-id="k3-f10"></span> is an oblique asymptote.</p></div></div>
    <div id="explanation3" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Detailed Explanation for Exercise 3</h3><span class="close-btn" onclick="closeModal('explanation3')">&times;</span></div><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">1. Study of <span class="katex-inline" data-id="e3-p1-f"></span></h4><p><strong>(a) Derivative:</strong> We use the chain rule for derivatives. <span class="katex-inline" data-id="e3-p1a-deriv-chain"></span>.</p><p><strong>(b) Taylor Expansion of f'(x):</strong> We start from <span class="katex-inline" data-id="e3-p1b-deriv"></span>. We write the expansions at 0 for <span class="katex-inline" data-id="e3-p1b-term1"></span> and <span class="katex-inline" data-id="e3-p1b-term2"></span>, then multiply them: <span class="katex-inline" data-id="e3-p1b-dl-prod"></span>.</p><p><strong>(c) Taylor Expansion of f(x):</strong> We integrate the expansion of <span class="katex-inline" data-id="e3-p1c-deriv"></span> and add the constant <span class="katex-inline" data-id="e3-p1c-f0"></span>. <span class="katex-inline" data-id="e3-p1c-dl-int"></span>.</p><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">2. Study of <span class="katex-inline" data-id="e3-p2-g"></span></h4><p><strong>(a) Taylor Expansion of g(x) at 2:</strong> We let <span class="katex-inline" data-id="e3-p2a-u"></span>. When <span class="katex-inline" data-id="e3-p2a-x2"></span>, <span class="katex-inline" data-id="e3-p2a-u0"></span>. We have <span class="katex-inline" data-id="e3-p2a-g-f"></span>. So we can directly use the expansion of f at 0 found previously, replacing x with u: <span class="katex-inline" data-id="e3-p2a-dl-f"></span>. We substitute <span class="katex-inline" data-id="e3-p2a-u-sub"></span> to get the expansion at 2.</p><p><strong>(b) Tangent:</strong> The first-order part of the expansion gives the equation of the tangent: <span class="katex-inline" data-id="e3-p2b-tan"></span>.</p><p><strong>(c) Position:</strong> We look at the next term in the expansion: <span class="katex-inline" data-id="e3-p2c-pos-term"></span>. Since <span class="katex-inline" data-id="e3-p2c-term-sign"></span> is negative in the neighborhood of 2, the curve is below the tangent.</p><h4 class="text-xl font-bold mt-4 mb-2 text-blue-300">3. Study of F and <span class="katex-inline" data-id="e3-p3-psi"></span></h4><p><strong>(a) Show F(x)=0:</strong> We differentiate F(x) for <span class="katex-inline" data-id="e3-p3a-x1"></span>. We find <span class="katex-inline" data-id="e3-p3a-deriv0"></span>. This means that F(x) is constant. We calculate its value at one point, for example <span class="katex-inline" data-id="e3-p3a-sqrt2"></span>: <span class="katex-inline" data-id="e3-p3a-Fsqrt2-0"></span>. Therefore F(x) is zero for all <span class="katex-inline" data-id="e3-p3a-x-ge-1"></span>.</p><p><strong>(b) Expansion of arccos(1/x):</strong> We let <span class="katex-inline" data-id="e3-p3b-u"></span>. When <span class="katex-inline" data-id="e3-p3b-x-inf"></span>, <span class="katex-inline" data-id="e3-p3b-u0"></span>. We use the standard expansion of arccos(u) at 0: <span class="katex-inline" data-id="e3-p3b-arccos-dl"></span>. We replace u with 1/x.</p><p><strong>(c) Asymptote:</strong> According to 3(a), we have <span class="katex-inline" data-id="e3-p3c-relation"></span>. Therefore <span class="katex-inline" data-id="e3-p3c-psi-arccos"></span>. We use the expansion from question 3(b): <span class="katex-inline" data-id="e3-p3c-psi-dl"></span>. The oblique asymptote is given by the terms in x and the constant: <span class="katex-inline" data-id="e3-p3c-asymp-eq"></span>.</p><p><strong>(d) Position:</strong> We look at the first remaining term in the expansion: <span class="katex-inline" data-id="e3-p3d-pos-term"></span>. It is negative as x approaches <span class="katex-inline" data-id="e3-p3d-inf"></span>, so the curve is below the asymptote.</p></div></div>

    <script>
        function renderKatex() {
            // Defer rendering slightly to ensure all content is loaded
            setTimeout(() => {
                document.querySelectorAll('.katex-inline, .katex-display').forEach(el => {
                    const content = el.dataset.latex || el.textContent;
                    const displayMode = el.classList.contains('katex-display');
                    try {
                        katex.render(content, el, {
                            throwOnError: false,
                            displayMode: displayMode
                        });
                    } catch (e) {
                        console.error("KaTeX rendering error:", e, "on element:", el);
                        el.textContent = `Error rendering formula: ${content}`;
                    }
                });
            }, 100);
        }
        
        function fillFormulas() {
            const formulas = {
                // Exam Questions from 16.html
                'ex1-q1': "\\int \\frac{\\cos x}{\\sin x - 2\\cos x} dx",
                'ex1-q2': "\\int_{0}^{\\log 2} e^x \\sqrt{e^x - 1} dx",
                'ex1-q3': "\\int x \\log(3x^2 + 2x - 1) dx",
                'ex2-I': "I = \\int_{0}^{\\frac{\\pi}{2}} \\frac{\\sin x}{\\sqrt{1+2\\sin x \\cos x}} dx",
                'ex2-J': "J = \\int_{0}^{\\frac{\\pi}{2}} \\frac{\\cos x}{\\sqrt{1+2\\sin x \\cos x}} dx",
                'ex2-q1-sub': "t = \\frac{\\pi}{2} - x",
                'ex2-q2-sum': "I + J",
                'ex3-q1-dom': "]-1, +\\infty[",
                'ex3-q1-f': "f(x) = \\operatorname{Arctg}(\\sqrt{x+1})",
                'ex3-q1a-deriv': "f'(x)",
                'ex3-q1a-f': "f(x)",
                'ex3-q1a-x': "x \\in ]-1, +\\infty[",
                'ex3-q1b-deriv': "f'(x)",
                'ex3-q1b-x0': "x_0 = 0",
                'ex3-q1c-f': "f(x)",
                'ex3-q1c-x0': "x_0 = 0",
                'ex3-q2-dom': "[1, +\\infty[",
                'ex3-q2-g': "g(x) = \\operatorname{Arctg}(\\sqrt{x-1})",
                'ex3-q2a-x0': "x_0 = 2",
                'ex3-q2b-cg': "(C_g)",
                'ex3-q2b-x0': "x_0 = 2",
                'ex3-q2c-cg': "(C_g)",
                'ex3-q2c-x0': "x_0 = 2",
                'ex3-q3-R': "\\mathbb{R}",
                'ex3-q3-R2': "\\mathbb{R}",
                'ex3-q3-F': "F(x) = \\operatorname{Arctg}(\\sqrt{x^2-1}) - \\operatorname{Arccos}(\\frac{1}{x})",
                'ex3-q3a-x': "x > 1",
                'ex3-q3a-F0': "F(x) = 0",
                'ex3-q3b-inf': "+\\infty",
                'ex3-q3b-phi': "\\varphi(x) = \\operatorname{Arccos}(\\frac{1}{x})",
                'ex3-q3c-inf': "+\\infty",
                'ex3-q3c-cpsi': "(C_\\psi)",
                'ex3-q3c-psi': "\\psi(x) = x \\operatorname{Arctg}(\\sqrt{x^2-1})",
                'ex3-q3d-cpsi': "(C_\\psi)",
                'ex3-q3d-inf': "+\\infty",

                // Solutions from 16.html
                'sol1-p1-int': "\\int \\frac{\\cos x}{\\sin x - 2\\cos x} dx",
                'sol1-p1-sub': "t = \\tan x",
                'sol1-p1-dx': "dx = \\frac{dt}{1+t^2}",
                'sol1-p1-new-int': "\\int \\frac{1}{t-2} \\frac{dt}{1+t^2}",
                'sol1-p1-decomp': "\\frac{1}{(t-2)(t^2+1)} = \\frac{A}{t-2} + \\frac{Bt+C}{t^2+1}",
                'sol1-p1-consts': "A=1/5, B=-1/5, C=-2/5",
                'sol1-p1-res': "\\frac{1}{5}\\ln|\\tan x - 2| + \\frac{1}{5}\\ln|\\cos x| - \\frac{2}{5}x + C_0",
                'sol1-p2-int': "\\int_{0}^{\\log 2} e^x \\sqrt{e^x - 1} dx",
                'sol1-p2-sub': "u = \\sqrt{e^x - 1}",
                'sol1-p2-rel': "u^2 = e^x - 1",
                'sol1-p2-du': "2u du = e^x dx",
                'sol1-p2-new-int': "\\int_{0}^{1} 2u^2 du = [\\frac{2u^3}{3}]_{0}^{1} = \\frac{2}{3}",
                'sol1-p3-int': "\\int x \\log(3x^2 + 2x - 1) dx",
                'sol1-p3-u': "u = \\log(3x^2+2x-1)",
                'sol1-p3-dv': "dv = x dx",
                'sol1-p3-ipp': "I = \\frac{x^2}{2}\\log(3x^2+2x-1) - \\int \\frac{3x^3+x^2}{3x^2+2x-1} dx",
                'sol1-p3-final': "I = \\frac{x^2-1}{2}\\log(3x^2+2x-1) - \\frac{x^2}{2} + \\frac{x}{3} - \\frac{1}{2}\\ln|x+1| - \\frac{1}{18}\\ln|3x-1| + C'",
                
                'sol2-p1-sub': "t = \\frac{\\pi}{2} - x",
                'sol2-p1-dt': "dt = -dx",
                'sol2-p1-eval': "I = \\int_{\\pi/2}^{0} \\frac{\\sin(\\pi/2-t)}{\\sqrt{1+2\\sin(\\pi/2-t)\\cos(\\pi/2-t)}} (-dt)",
                'sol2-p1-sin': "\\sin(\\pi/2-t) = \\cos t",
                'sol2-p1-cos': "\\cos(\\pi/2-t) = \\sin t",
                'sol2-p1-J': "\\int_{0}^{\\pi/2} \\frac{\\cos t}{\\sqrt{1+2\\cos t \\sin t}} dt = J",
                'sol2-p1-eq': "I = J",
                'sol2-p2-sum': "I+J",
                'sol2-p2-sum-int': "I+J = \\int_{0}^{\\pi/2} \\frac{\\sin x + \\cos x}{\\sqrt{1+2\\sin x \\cos x}} dx",
                'sol2-p2-denom': "\\sqrt{(\\sin x + \\cos x)^2} = |\\sin x + \\cos x|",
                'sol2-p2-interval': "[0, \\pi/2]",
                'sol2-p2-res': "I+J = \\int_{0}^{\\pi/2} 1 dx = \\frac{\\pi}{2}",
                'sol2-p3-eq': "I=J",
                'sol2-p3-sum': "I+J=\\pi/2",
                'sol2-p3-final': "I = J = \\frac{\\pi}{4}",

                'sol3-p1a-f': "f(x) = \\operatorname{Arctg}(\\sqrt{x+1})",
                'sol3-p1a-deriv': "f'(x) = \\frac{1}{2(x+2)\\sqrt{x+1}}",
                'sol3-p1b-deriv': "f'(x)",
                'sol3-p1b-dl': "f'(x) = \\frac{1}{4} - \\frac{x}{4} + o(x)",
                'sol3-p1c-f': "f(x)",
                'sol3-p1c-dl': "f(x) = \\frac{\\pi}{4} + \\frac{x}{4} - \\frac{x^2}{8} + o(x^2)",
                'sol3-p2a-g': "g(x) = \\operatorname{Arctg}(\\sqrt{x-1})",
                'sol3-p2a-u': "u = x-2",
                'sol3-p2a-dl': "g(x) = \\frac{\\pi}{4} + \\frac{x-2}{4} - \\frac{(x-2)^2}{8} + o((x-2)^2)",
                'sol3-p2b-x0': "x_0=2",
                'sol3-p2b-tan': "y = g(2) + g'(2)(x-2) = \\frac{\\pi}{4} + \\frac{1}{4}(x-2)",
                'sol3-p2c-pos': "g(x) - y = -\\frac{(x-2)^2}{8} + o((x-2)^2)",
                'sol3-p3a-x': "x>1",
                'sol3-p3a-deriv': "F'(x) = 0",
                'sol3-p3a-Fsqrt2': "F(\\sqrt{2})=0",
                'sol3-p3a-F0': "F(x)=0",
                'sol3-p3b-arccos': "\\operatorname{Arccos}(1/x)",
                'sol3-p3b-inf': "+\\infty",
                'sol3-p3b-dl': "\\varphi(x) = \\frac{\\pi}{2} - \\frac{1}{x} - \\frac{1}{6x^3} + o(\\frac{1}{x^3})",
                'sol3-p3c-psi-eq': "\\psi(x) = x \\operatorname{Arccos}(1/x)",
                'sol3-p3c-asymp': "\\psi(x) = \\frac{\\pi}{2}x - 1 - \\frac{1}{6x^2} + o(\\frac{1}{x^2})",
                'sol3-p3c-asymp-eq': "y = \\frac{\\pi}{2}x - 1",
                'sol3-p3d-diff': "\\psi(x) - y = -\\frac{1}{6x^2} + o(\\frac{1}{x^2})",

                // Modal Formulas
                'h1-k1': "\\cos x",
                'k1-f1': "x = \\phi(t)",
                'k1-f2': "\\int f(x)dx = \\int f(\\phi(t)) \\phi'(t) dt",
                'k1-f3': "\\int u dv = uv - \\int v du",
                'e1-p1-int': "\\int \\frac{\\cos x}{\\sin x - 2\\cos x} dx",
                'e1-p1-cos': "\\cos x",
                'e1-p1-tan-form': "\\int \\frac{1}{\\tan x - 2} dx",
                'e1-p1-sub': "t = \\tan x",
                'e1-p1-dx': "dx = \\frac{dt}{1+t^2}",
                'e1-p1-t-int': "\\int \\frac{1}{(t-2)(1+t^2)} dt",
                'e1-p1-frac': "\\frac{1}{(t-2)(1+t^2)}",
                'e1-p1-decomp': "\\frac{A}{t-2} + \\frac{Bt+C}{t^2+1}",
                'e1-p1-coeffs': "A=1/5, B=-1/5, C=-2/5",
                'e1-p1-int-decomp': "\\frac{1}{5} \\int (\\frac{1}{t-2} - \\frac{t+2}{t^2+1}) dt",
                'e1-p1-res-t': "\\frac{1}{5}\\ln|t-2| - \\frac{1}{10}\\ln(t^2+1) - \\frac{2}{5}\\arctan(t) + C",
                'e1-p2-int': "\\int_{0}^{\\log 2} e^x \\sqrt{e^x - 1} dx",
                'e1-p2-sub': "u = \\sqrt{e^x - 1}",
                'e1-p2-u2': "u^2 = e^x - 1",
                'e1-p2-du': "2u du = e^x dx",
                'e1-p2-x0': "x=0",
                'e1-p2-u0': "u=0",
                'e1-p2-xlog2': "x=\\log 2",
                'e1-p2-u1': "u=1",
                'e1-p2-new-int': "\\int_0^1 u \\cdot (2u du) = \\int_0^1 2u^2 du",
                'e1-p2-calc': "[\\frac{2u^3}{3}]_0^1 = \\frac{2}{3}",
                'e1-p3-int': "\\int x \\log(3x^2 + 2x - 1) dx",
                'e1-p3-ipp-formula': "\\int u dv = uv - \\int v du",
                'e1-p3-u': "u = \\log(3x^2+2x-1)",
                'e1-p3-dv': "dv = xdx",
                'e1-p3-du': "du = \\frac{6x+2}{3x^2+2x-1} dx",
                'e1-p3-v': "v = x^2/2",
                'e1-p3-ipp-res': "\\frac{x^2}{2}\\log(3x^2+2x-1) - \\int \\frac{x^2}{2} \\frac{6x+2}{3x^2+2x-1} dx",
                'e1-p3-rem-int': "\\int \\frac{3x^3+x^2}{3x^2+2x-1} dx",
                'e1-p3-num': "3x^3+x^2",
                'e1-p3-den': "3x^2+2x-1",
                
                'h2-k1': "t = \\pi/2 - x",
                'h2-k2': "dx",
                'h2-k3': "\\sin(\\pi/2 - t)",
                'h2-k4': "\\cos(\\pi/2 - t)",
                'h2-k5': "I+J",
                'k2-f1': "\\sin(\\pi/2 - x) = \\cos x",
                'k2-f2': "\\cos(\\pi/2 - x) = \\sin x",
                'k2-f3': "(\\sin x + \\cos x)^2 = \\sin^2 x + \\cos^2 x + 2\\sin x \\cos x = 1 + 2\\sin x \\cos x",
                'k2-f4': "\\int (f+g) = \\int f + \\int g",
                'e2-p1-I': "I = \\int_{0}^{\\pi/2} \\frac{\\sin x}{\\sqrt{1+2\\sin x \\cos x}} dx",
                'e2-p1-sub': "t = \\pi/2 - x",
                'e2-p1-x': "x = \\pi/2 - t",
                'e2-p1-dt': "dx = -dt",
                'e2-p1-x0': "x=0",
                'e2-p1-tpi2': "t=\\pi/2",
                'e2-p1-xpi2': "x=\\pi/2",
                'e2-p1-t0': "t=0",
                'e2-p1-int-sub': "I = \\int_{\\pi/2}^0 \\frac{\\sin(\\pi/2-t)}{\\sqrt{1+2\\sin(\\pi/2-t)\\cos(\\pi/2-t)}} (-dt)",
                'e2-p1-sin': "\\sin(\\pi/2-t) = \\cos t",
                'e2-p1-cos': "\\cos(\\pi/2-t) = \\sin t",
                'e2-p1-int-trans': "\\int_0^{\\pi/2} \\frac{\\cos t}{\\sqrt{1+2\\cos t \\sin t}} dt",
                'e2-p1-eq': "I=J",
                'e2-p2-sum-int': "I+J = \\int_0^{\\pi/2} \\frac{\\sin x + \\cos x}{\\sqrt{1+2\\sin x \\cos x}} dx",
                'e2-p2-denom-id': "1+2\\sin x \\cos x = (\\sin x + \\cos x)^2",
                'e2-p2-sqrt': "\\sqrt{(\\sin x + \\cos x)^2} = |\\sin x + \\cos x|",
                'e2-p2-interval': "[0, \\pi/2]",
                'e2-p2-pos': "\\sin x + \\cos x \\ge 0",
                'e2-p2-simp-int': "I+J = \\int_0^{\\pi/2} \\frac{\\sin x + \\cos x}{\\sin x + \\cos x} dx = \\int_0^{\\pi/2} 1 dx = \\frac{\\pi}{2}",
                'e2-p3-eq1': "I=J",
                'e2-p3-eq2': "I+J = \\pi/2",
                'e2-p3-subst': "2I = \\pi/2",
                'e2-p3-I': "I = \\pi/4",
                'e2-p3-IeqJ': "I=J",
                'e2-p3-J': "J = \\pi/4",
                
                'h3-k1': "(1+u)^a",
                'h3-k2': "\\operatorname{Arccos} u",
                'h3-k3': "y = f(a) + f'(a)(x-a)",
                'h3-k4': "F(x)=0",
                'h3-k5': "x=\\sqrt{2}",
                'h3-k6': "\\operatorname{Arccos}(1/x)",
                'h3-k7': "+\\infty",
                'k3-f1': "(\\operatorname{Arctg} u)' = \\frac{1}{1+u^2}",
                'k3-f2': "(\\operatorname{Arccos} u)' = -\\frac{1}{\\sqrt{1-u^2}}",
                'k3-f3': "(1+u)^\\alpha = 1 + \\alpha u + \\frac{\\alpha(\\alpha-1)}{2!}u^2 + o(u^2)",
                'k3-f4': "\\frac{1}{1+u} = 1 - u + u^2 + o(u^2)",
                'k3-f5': "\\operatorname{Arccos} u = \\frac{\\pi}{2} - u - \\frac{u^3}{6} + o(u^3)",
                'k3-f6': "f(x) = f(0) + f'(0)x + \\frac{f''(0)}{2!}x^2 + o(x^2)",
                'k3-f7': "y = f(x_0) + f'(x_0)(x-x_0)",
                'k3-f8': "f(x) - y",
                'k3-f9': "\\lim_{x\\to\\infty} [f(x) - (ax+b)] = 0",
                'k3-f10': "y=ax+b",
                'e3-p1-f': "f(x) = \\operatorname{Arctg}(\\sqrt{x+1})",
                'e3-p1a-deriv-chain': "f'(x) = \\frac{1}{1+(\\sqrt{x+1})^2} \\cdot \\frac{1}{2\\sqrt{x+1}} = \\frac{1}{2(x+2)\\sqrt{x+1}}",
                'e3-p1b-deriv': "f'(x) = \\frac{1}{2(2+x)\\sqrt{1+x}}",
                'e3-p1b-term1': "\\frac{1}{1+x/2} = 1 - x/2 + o(x)",
                'e3-p1b-term2': "(1+x)^{-1/2} = 1 - x/2 + o(x)",
                'e3-p1b-dl-prod': "f'(x) = \\frac{1}{4}(1-x/2+o(x))(1-x/2+o(x)) = \\frac{1}{4}(1-x+o(x))",
                'e3-p1c-deriv': "f'(t)",
                'e3-p1c-f0': "f(0) = \\operatorname{Arctg}(1) = \\pi/4",
                'e3-p1c-dl-int': "f(x) = f(0) + \\int_0^x (\\frac{1}{4} - \\frac{t}{4} + o(t)) dt = \\frac{\\pi}{4} + \\frac{x}{4} - \\frac{x^2}{8} + o(x^2)",
                'e3-p2-g': "g(x) = \\operatorname{Arctg}(\\sqrt{x-1})",
                'e3-p2a-u': "u=x-2",
                'e3-p2a-x2': "x \\to 2",
                'e3-p2a-u0': "u \\to 0",
                'e3-p2a-g-f': "g(x) = \\operatorname{Arctg}(\\sqrt{1+u}) = f(u)",
                'e3-p2a-dl-f': "f(u) = \\frac{\\pi}{4} + \\frac{u}{4} - \\frac{u^2}{8} + o(u^2)",
                'e3-p2a-u-sub': "u=x-2",
                'e3-p2b-tan': "y = \\frac{\\pi}{4} + \\frac{1}{4}(x-2)",
                'e3-p2c-pos-term': "g(x) - y = -\\frac{(x-2)^2}{8} + o((x-2)^2)",
                'e3-p2c-term-sign': "-\\frac{(x-2)^2}{8}",
                'e3-p3-psi': "\\psi(x)",
                'e3-p3a-x1': "x>1",
                'e3-p3a-deriv0': "F'(x) = 0",
                'e3-p3a-sqrt2': "x=\\sqrt{2}",
                'e3-p3a-Fsqrt2-0': "F(\\sqrt{2}) = \\operatorname{Arctg}(1) - \\operatorname{Arccos}(1/\\sqrt{2}) = \\pi/4 - \\pi/4 = 0",
                'e3-p3a-x-ge-1': "x \\ge 1",
                'e3-p3b-u': "u=1/x",
                'e3-p3b-x-inf': "x \\to +\\infty",
                'e3-p3b-u0': "u \\to 0",
                'e3-p3b-arccos-dl': "\\operatorname{Arccos} u = \\pi/2 - u - u^3/6 + o(u^3)",
                'e3-p3c-relation': "\\operatorname{Arctg}(\\sqrt{x^2-1}) = \\operatorname{Arccos}(1/x)",
                'e3-p3c-psi-arccos': "\\psi(x) = x \\operatorname{Arccos}(1/x)",
                'e3-p3c-psi-dl': "\\psi(x) = x(\\frac{\\pi}{2} - \\frac{1}{x} - \\frac{1}{6x^3} + o(\\frac{1}{x^3})) = \\frac{\\pi}{2}x - 1 - \\frac{1}{6x^2} + o(\\frac{1}{x^2})",
                'e3-p3c-asymp-eq': "y = \\frac{\\pi}{2}x - 1",
                'e3-p3d-pos-term': "\\psi(x) - y = -\\frac{1}{6x^2} + o(\\frac{1}{x^2})",
                'e3-p3d-inf': "+\\infty",

                // CS Section formulas
                'cs2-IeqJ': "I = J",
                'cs3-sin': "\\sin(x)",
                'cs3-exp': "\\exp(x)",
                'cs3-sin-dl': "x - \\frac{x^3}{3!} + \\frac{x^5}{5!} - \\dots"
            };

            for (const [id, latex] of Object.entries(formulas)) {
                const el = document.querySelector(`[data-id='${id}']`);
                if (el) {
                    el.dataset.latex = latex;
                    el.textContent = latex; // Fallback text
                } else {
                    // It's okay if CS formulas are not found in the initial HTML, they are added dynamically.
                    if (!id.startsWith('cs')) {
                         console.error(`Element with data-id '${id}' not found.`);
                    }
                }
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = "flex";
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let i = 0; i < modals.length; i++) {
                if (event.target == modals[i]) {
                    modals[i].style.display = "none";
                }
            }
        }
        
        document.addEventListener("DOMContentLoaded", function() {
            fillFormulas();
            renderKatex();
        });
    </script>
</body>
</html>